# Discovery of post-translationally modified self-peptides that promote hypertension

This repository contains the code, data, and a protocol capture to reproduce the findings reported in the manuscript above.

## Contents:
|Folder|Contents|
|---|---|
|code/|Contains code used to generate FlexPepDock templates|
|peptides/|List proteins and derivative peptides used for modeling IsoLG adduction|
|params/|Rosetta params file and rotamers library for modeling IsoLG adducted lysine|

## Protocol Capture

### Creating IsoLG-adducted lysine residues for use in Rosetta

We use the biochemical library (BCL), developed by the Meiler lab and collaborators (1), to 
generate custom ROSETTA params file and rotamer libraries for IsoLG-adducted lysine (abbreviated
KIS). The process is briefly described with example code below.

- PATH_TO_BCL: path to the biochemical library executable
- KIS_preoptimized.sdf: Initial IsoLG-adducted lysine .sdf created in step 1
- KIS.sdf: Optimized IsoLG-adducted lysine created in step 2
- KIS_rotamers.sdf: rotamers file created in step 3
- PATH_TO_ROSETTA: path to ROSETTA 3.13 installation /main folder

1. Starting with a 2D or 3D chemical structure in SDF format, use Pymol or a similar molecular
graphics software tool to add or remove additional molecules until the side chain structure
matches that of the desired KIS. Add additional N-terminus acetylated and C-teminus methylated
capping groups.
2. Generate an 3D structure of your KIS amino acid with optimized bond angles and steriochemistry using the BCL molecule:GenerateRosettaNCAAInstructions application
```
$ PATH_TO_BCL/bcl.exe molecule:GenerateRosettaNCAAInstructions \
    -input_filenames KIS_preoptimized.sdf \
    -generate_3D \
    -chirality L_AA \
    -explicit_aromaticity
```
3. Generate a rotamer library using the BCL molecule:ConformerGenerator application
```
$ PATH_TO_BCL/bcl.exe molecule:ConformerGenerator \
    -ensemble_filenames KIS.sdf \
    -conformation_comparer SymmetryRMSD 0.25 \
    -max_iterations 2000 \
    -top_models 200 \
    -cluster \
    -explicit_aromaticity \
    -rotamers_single_file KIS_rotamers.sdf
```
4. Generate a ROSETTA .params file using molfile_to_params_polymer.py. NOTE: this script is located in PATH_TO_ROSETTA/main/source/scripts/python/public
```
$ python molfile_to_params_polymer.py \
    -n KIS \
    -p KIS \
    --polymer \
    --no-pdb \
    KIS_rotamers.sdf
```
5. Convert KIS_rotamers.sdf to PDB format using obabel or similar program
6. Rename heavy atoms in KIS_rotamers.pdb so they match ROSETTA atom names in KIS.params file
7. Add the following line to the end of the KIS.params file:
```
    PDB_ROTAMERS KIS_rotamers.pdb
```
8. You can now run the ROSETTA FlexPepDock application with the -extra_res and/or -extra_res_fa flags followed by the path to the KIS.params file. Ensure KIS_rotamers.pdb is located in the same path as KIS.params at runtime.

### Generating peptide-MHC-I models containing IsoLG-adducted lysine with FlexPepDock

Peptide-MHC-I complexes were generated using the Rosetta application FlexPepDock, with a template starting structure generated using a custom python script called IEDBTestPipeline.py. Templates were generated using a custom python application called HLA_db, which will automatically curate a database of peptide/MHC structures available in the PDB. Python scripts are available in the code/ folder. Steps to produce peptide/MHC-I  models are detailed below:

Files and environmental variables used in this example:

- peptide1.fasta : fasta files containing the peptides we wish to dock (may contain any number of peptides) (the amino acid "X" will be substituted with IsoLG-adducted lysine; replacing "X" with "K" will generate structures with lysine).
- PATH_TO_ROSETTA : Path to the local Rosetta installation /main/source/bin folder
- HLA_A0201.pdb : PDB file of the MHC-I we will dock peptides to, generated by AlphaFold2 (alpha-1 and alpha-2 domains) (HLA-A\*02:01 in this example).
- KIS.params : Rosetta params file for IsoLG-modified lysine. Folder containing KIS.params must also contain the PDB rotamers file, KIS_rotamers.pdb
```
	>peptide1
	LAGXNLTHI
```
1. Generate local database of peptide/MHC-I crystal structures to use as templates.
```
	from HLA_db import MHCdatabase
	db=MHCdatabase()
	db.build()
```

2. Using the IEDBTestPipeline.py script, create a prepacked input model to use for FlexPepDocking
```
	$ python IEDBTestPipeline.py \
		--IEDBquery skip \
		--setAllele A*02:01 \
		--receptor HLA_A0201.pdb \
		--params KIS.params \
		--buildFasta peptide1.fasta 0
```

Running this script generates the folder peptide1/ which contains the following files:

- peptide1.fasta : .fasta file containing the sequence in the correct notation for Rosetta to place the IsoLG adducted lysine
- tmp_receptor.pdb : The MHC-I model used for the initial pose
- flexpepdock_input_peptide1.xml : A RosettaScripts file generated to produce the prepacked input structure. Can be run separately using RosettaScripts to re-generate the input file(s).
- score.sc : The prepacked structure scorefile
- peptide1_input.pdb : The prepacked structure generated by FlexPepDocking
- peptide1.options : The options file for running FlexPepDocking using the prepacked structure as input

Alternatively, select a PDB template using HLA_db.MHCdatabase, and the following RosettaScripts protocol to generate prepacked input structures. Using the Rosetta Scripts mover SimpleThreadingMover, mutate the template residue to match the desired sequence. Add the IsoLG-adducted lysine with the MutateResidue mover. Add the MHC-I of interest with the AddChain mover. Run the scripted protocol (see Ref (2) for details on using RosettaScripts).


flexpepdock_input_peptide1.xml:
```
    <ROSETTASCRIPTS>
	    <MOVERS>
	        <SimpleThreadingMover name="threadModel" pack_neighbors="1" start_position="1C" thread_sequence="LAGXNLTHI" skip_unknown_mutant="1" pack_rounds="1" />
	        <MutateResidue name="mutateRes_4" target="4C" new_res="KIS" />
	        <DeleteRegionMover name="deleteRes_receptor" start="182A" end="275A" rechain="1" />
	        <AddChain name="addReceptor" file_name="tmp_receptor.pdb" swap_chain_number="1" />
	        <FlexPepDock name="prepack" ppk_only="1" />
	    </MOVERS>
	    <PROTOCOLS>
	        <Add mover="threadModel" />
	        <Add mover="mutateRes_4" />
	        <Add mover="deleteRes_receptor" />
	        <Add mover="addReceptor" />
	        <Add mover="prepack" />
	    </PROTOCOLS>
	</ROSETTASCRIPTS>
```

Python script to retrieve the optimal template for the peptide we want to model:
```
	from HLA_db import MHCdatabase
	import os
	import shutil

	# Retrieve the template name from the HLA database built in step 1:
	db=MHCdatabase(allele="A*02:01")
	db_path=db.locate
	query_sequence="LAGXNLTHI"
	pdb_template=db.get_peptide_template(query_sequence)

	# Copy the template structure to the working directory:
	pdb_template_source=os.path.join(db_path,"templates",pdb_template+".pdb")
	pdb_template_destination=os.path.join(os.getcwd(),"template.pdb")
	shutil(pdb_template_source, pdb_template_destination)
```
Call RosettaScripts from the command line using the defined protocol and template.pdb file:
```
    $ PATH_TO_ROSETTA/rosetta_scripts.linuxgccrelease \
        -in:file:s template.pdb \
        -parser:protocol flexpepdock_input_peptide1.xml \
        -extra_res_fa KIS.params \
        -ex1 -ex2aro -nstruct 1 \
```

3. Run FlexPepDock
```
    $ PATH_TO_ROSETTA/FlexPepDocking.linuxgccrelease \
        -in:file:s peptide1_input.pdb \
        -extra_res_fa KIS.params \
        -ex1 -ex2aro -nstruct 250 \
        -out:file:silent peptide1.silent
```

Running this command creates 250 peptide/MHC-I decoys contained in the file peptide1.silent. Extract Rosetta score data for optimal decoy selection with the following command:
```
    $ grep '^SCORE' peptide1.silent >peptide1.sc
```

## References

1. Brown BP et al. Front Pharmacol. 2022;13: 833099.
2. Fleishman SJ et al. PLoS One. 2011;6: e20161.
